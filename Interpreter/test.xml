<project name="Compiler" default="test" basedir=".">
  <property name="cl"      location="cl"      />
  <property name="cup"     location="cup"     />
  <property name="flex"    location="flex"    />
  <property name="src"     location="src"     />
  <property name="java"    location="java"    />
  <property name="classes" location="classes" />
  <property name="dist"    location="dist"    />
  <property name="lib"     location="lib"     />
  <property name="bin"     location="bin"  />
  <property name="test"	   location="test" />
  <property name="testoutput" location="testoutput" />
  <property environment="env" />

  <!-- We rely on CUP-10k-TUM, JFlex 1.3.5 and Classgen 1.5pre -->
  <!-- residing in our directory ``bin'' -->
  <path id="binaries">
    <pathelement location="${lib}" />
    <fileset dir="${lib}">
      <include name="**/*.jar" />
      <include name="**/*.zip" />
    </fileset>
    <pathelement path="${java.class.path}" />
    <pathelement path="${bin}" />
  </path>

  <path id="libraries">
    <pathelement location="${lib}" />
    <fileset dir="${lib}">
      <include name="**/*.jar" />
      <include name="**/*.zip" />
    </fileset>
    <pathelement path="${java.class.path}" />
  </path>

  <target name="init">
    <mkdir dir="${bin}"/>
    <mkdir dir="${testoutput}" />
  </target>

  <target name="compile" depends="init">
    <javac srcdir="${src}" destdir="${bin}" debug="on">
    	<classpath refid="binaries" />
    </javac>
  </target>

  <target name="test" depends="compile">
  	 <junit>
  	    <classpath>
  	      <pathelement location="${bin}" />    
  	      <pathelement location="${lib}/junit-4.11.jar"/>
    	  <pathelement location="${lib}/hamcrest-core-1.3.jar"/>
  	    </classpath>
  	    <batchtest todir="testoutput">
  	       <fileset dir="${src}">
  	            <include name="**/*Test*" />
  	       </fileset>
  	    </batchtest>
  	    <formatter type="xml" usefile="true"/>
  	  </junit>
  </target>

  <target name="clean">
    <delete dir="${bin}" />
  </target>
</project>
